<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokédex Nacional Completa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .pokemon-card {
            transition: all 0.3s ease;
        }
        .pokemon-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .stat-bar {
            transition: width 0.5s ease;
        }
        .type-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: white;
        }
        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .modal {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        .modal.active {
            display: flex;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .evolution-arrow {
            position: relative;
            padding: 0 1rem;
        }
        .evolution-arrow::after {
            content: '→';
            position: absolute;
            right: -0.5rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            color: #666;
        }
        .move-method {
            display: inline-block;
            padding: 0.125rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .move-level { background-color: #10b981; color: white; }
        .move-tm { background-color: #3b82f6; color: white; }
        .move-tutor { background-color: #8b5cf6; color: white; }
        .move-egg { background-color: #f59e0b; color: white; }
        .type-table {
            border-collapse: collapse;
            width: 100%;
            font-size: 0.875rem;
        }
        .type-table th, .type-table td {
            border: 1px solid #e5e7eb;
            padding: 0.5rem;
            text-align: center;
        }
        .type-table th {
            font-weight: 600;
            background-color: #f9fafb;
        }
        .effectiveness-0 { background-color: #fee2e2; color: #991b1b; }
        .effectiveness-025 { background-color: #fecaca; color: #991b1b; }
        .effectiveness-05 { background-color: #fed7aa; color: #9a3412; }
        .effectiveness-1 { background-color: #f3f4f6; color: #374151; }
        .effectiveness-2 { background-color: #bbf7d0; color: #166534; }
        .effectiveness-4 { background-color: #86efac; color: #166534; }
        .location-item {
            transition: all 0.2s ease;
        }
        .location-item:hover {
            background-color: #f3f4f6;
            transform: translateX(5px);
        }
        .location-method {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
            background-color: #e5e7eb;
            color: #374151;
        }
        .location-method.wild { background-color: #86efac; color: #166534; }
        .location-method.evolve { background-color: #fbbf24; color: #92400e; }
        .location-method.event { background-color: #f472b6; color: #9f1239; }
        .location-method.trade { background-color: #a78bfa; color: #5b21b6; }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-gradient-to-r from-red-500 to-red-600 text-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <i class="fas fa-dragon text-3xl"></i>
                    <h1 class="text-2xl md:text-3xl font-bold">Pokédex Nacional</h1>
                </div>
                <div class="relative w-full md:w-96">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Buscar por nombre o número..."
                        class="w-full px-4 py-2 pl-10 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-white"
                    >
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Contenido Principal -->
    <main class="container mx-auto px-4 py-6">
        <!-- Vista Pokédex -->
        <div id="pokedexView">
            <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                <div class="flex items-center gap-4">
                    <label class="flex items-center gap-2">
                        <span class="text-gray-700">Ver:</span>
                        <select id="viewMode" class="px-3 py-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                            <option value="grid">Cuadrícula</option>
                            <option value="list">Lista</option>
                        </select>
                    </label>
                    <label class="flex items-center gap-2">
                        <span class="text-gray-700">Por página:</span>
                        <select id="itemsPerPage" class="px-3 py-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                            <option value="20">20</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </label>
                </div>
                <div id="pagination" class="flex items-center gap-2"></div>
            </div>

            <div id="pokemonContainer" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                <!-- Los Pokémon se cargarán aquí -->
            </div>

            <div id="loadingIndicator" class="hidden text-center py-8">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-red-500"></div>
                <p class="mt-2 text-gray-600">Cargando Pokémon...</p>
            </div>
        </div>

        <!-- Vista Tabla de Tipos -->
        <div class="mt-12">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-4">
                    <i class="fas fa-shield-alt text-blue-500 mr-2"></i>Tabla de Efectividad de Tipos
                </h2>
                <p class="text-gray-600 mb-4">Esta tabla muestra cómo cada tipo afecta a los demás en batalla.</p>
                <div class="overflow-x-auto">
                    <table class="type-table">
                        <thead>
                            <tr>
                                <th>Ataque \ Defensa</th>
                                <th><span class="type-badge" style="background-color: #A8A878">Normal</span></th>
                                <th><span class="type-badge" style="background-color: #F08030">Fuego</span></th>
                                <th><span class="type-badge" style="background-color: #6890F0">Agua</span></th>
                                <th><span class="type-badge" style="background-color: #F8D030">Eléctrico</span></th>
                                <th><span class="type-badge" style="background-color: #78C850">Planta</span></th>
                                <th><span class="type-badge" style="background-color: #98D8D8">Hielo</span></th>
                                <th><span class="type-badge" style="background-color: #C03028">Lucha</span></th>
                                <th><span class="type-badge" style="background-color: #A040A0">Veneno</span></th>
                                <th><span class="type-badge" style="background-color: #E0C068">Tierra</span></th>
                                <th><span class="type-badge" style="background-color: #A890F0">Volador</span></th>
                                <th><span class="type-badge" style="background-color: #F85888">Psíquico</span></th>
                                <th><span class="type-badge" style="background-color: #A8B820">Bicho</span></th>
                                <th><span class="type-badge" style="background-color: #B8A038">Roca</span></th>
                                <th><span class="type-badge" style="background-color: #705898">Fantasma</span></th>
                                <th><span class="type-badge" style="background-color: #7038F8">Dragón</span></th>
                                <th><span class="type-badge" style="background-color: #705848">Siniestro</span></th>
                                <th><span class="type-badge" style="background-color: #B8B8D0">Acero</span></th>
                                <th><span class="type-badge" style="background-color: #EE99AC">Hada</span></th>
                            </tr>
                        </thead>
                        <tbody id="typeTableBody">
                            <!-- La tabla se generará con JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 effectiveness-0"></div>
                        <span>No afecta (0x)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 effectiveness-025"></div>
                        <span>Muy poco efectivo (0.25x)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 effectiveness-05"></div>
                        <span>Poco efectivo (0.5x)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 effectiveness-1"></div>
                        <span>Normal (1x)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 effectiveness-2"></div>
                        <span>Super efectivo (2x)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 effectiveness-4"></div>
                        <span>Extremadamente efectivo (4x)</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal de Detalles del Pokémon -->
    <div id="pokemonModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b p-4 flex justify-between items-center">
                <h2 id="modalTitle" class="text-2xl font-bold text-gray-800"></h2>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div id="modalContent" class="p-6">
                <!-- El contenido del modal se cargará aquí -->
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let currentPage = 1;
        let itemsPerPage = 20;
        let viewMode = 'grid';
        let allPokemon = [];
        let filteredPokemon = [];
        let loading = false;

        // Tipos de Pokémon con colores
        const typeColors = {
            normal: '#A8A878', fire: '#F08030', water: '#6890F0', electric: '#F8D030',
            grass: '#78C850', ice: '#98D8D8', fighting: '#C03028', poison: '#A040A0',
            ground: '#E0C068', flying: '#A890F0', psychic: '#F85888', bug: '#A8B820',
            rock: '#B8A038', ghost: '#705898', dragon: '#7038F8', dark: '#705848',
            steel: '#B8B8D0', fairy: '#EE99AC'
        };

        // Matriz de efectividad de tipos
        const typeEffectiveness = {
            normal: { rock: 0.5, ghost: 0, steel: 0.5 },
            fire: { fire: 0.5, water: 0.5, grass: 2, ice: 2, bug: 2, rock: 0.5, dragon: 0.5, steel: 2 },
            water: { fire: 2, water: 0.5, grass: 0.5, ground: 2, rock: 2, dragon: 0.5 },
            electric: { water: 2, electric: 0.5, grass: 0.5, ground: 0, flying: 2, dragon: 0.5 },
            grass: { fire: 0.5, water: 2, grass: 0.5, poison: 0.5, ground: 2, flying: 0.5, bug: 0.5, rock: 2, dragon: 0.5, steel: 0.5 },
            ice: { fire: 0.5, water: 0.5, grass: 2, ice: 0.5, ground: 2, flying: 2, dragon: 2, steel: 0.5 },
            fighting: { normal: 2, ice: 2, poison: 0.5, flying: 0.5, psychic: 0.5, bug: 0.5, rock: 2, ghost: 0, dark: 2, steel: 2, fairy: 0.5 },
            poison: { grass: 2, poison: 0.5, ground: 0.5, rock: 0.5, ghost: 0.5, steel: 0, fairy: 2 },
            ground: { fire: 2, electric: 2, grass: 0.5, poison: 2, flying: 0, bug: 0.5, rock: 2, steel: 2 },
            flying: { electric: 0.5, grass: 2, fighting: 2, bug: 2, rock: 0.5, steel: 0.5 },
            psychic: { fighting: 2, poison: 2, psychic: 0.5, dark: 0, steel: 0.5 },
            bug: { fire: 0.5, grass: 2, fighting: 0.5, poison: 0.5, flying: 0.5, psychic: 2, ghost: 0.5, dark: 2, steel: 0.5, fairy: 0.5 },
            rock: { fire: 2, ice: 2, fighting: 0.5, ground: 0.5, flying: 2, bug: 2, steel: 0.5 },
            ghost: { normal: 0, psychic: 2, ghost: 2, dark: 0.5 },
            dragon: { dragon: 2, steel: 0.5, fairy: 0 },
            dark: { fighting: 0.5, psychic: 2, ghost: 2, dark: 0.5, fairy: 0.5 },
            steel: { fire: 0.5, water: 0.5, electric: 0.5, ice: 2, rock: 2, steel: 0.5, fairy: 2 },
            fairy: { fire: 0.5, fighting: 2, poison: 0.5, dragon: 2, dark: 2, steel: 0.5 }
        };

        // Inicialización
        document.addEventListener('DOMContentLoaded', () => {
            loadPokemonList();
            setupEventListeners();
            generateTypeTable();
        });

        // Configurar event listeners
        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            document.getElementById('viewMode').addEventListener('change', handleViewModeChange);
            document.getElementById('itemsPerPage').addEventListener('change', handleItemsPerPageChange);
        }

        // Cargar lista de Pokémon
        async function loadPokemonList() {
            if (loading) return;
            loading = true;
            showLoading();

            try {
                const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=1010');
                const data = await response.json();
                allPokemon = data.results.map((pokemon, index) => ({
                    ...pokemon,
                    id: index + 1
                }));
                filteredPokemon = [...allPokemon];
                renderPokemon();
                renderPagination();
            } catch (error) {
                console.error('Error al cargar la lista de Pokémon:', error);
                showError('Error al cargar los Pokémon. Por favor, intenta de nuevo.');
            } finally {
                loading = false;
                hideLoading();
            }
        }

        // Renderizar Pokémon
        function renderPokemon() {
            const container = document.getElementById('pokemonContainer');
            container.innerHTML = '';

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pokemonToShow = filteredPokemon.slice(startIndex, endIndex);

            if (viewMode === 'grid') {
                container.className = 'grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4';
                pokemonToShow.forEach(pokemon => {
                    container.appendChild(createPokemonCard(pokemon));
                });
            } else {
                container.className = 'space-y-2';
                pokemonToShow.forEach(pokemon => {
                    container.appendChild(createPokemonListItem(pokemon));
                });
            }
        }

        // Crear tarjeta de Pokémon (vista cuadrícula)
        function createPokemonCard(pokemon) {
            const card = document.createElement('div');
            card.className = 'pokemon-card bg-white rounded-lg shadow-md p-4 cursor-pointer hover:shadow-xl';
            card.onclick = () => showPokemonDetails(pokemon.id);

            const paddedId = String(pokemon.id).padStart(3, '0');
            
            card.innerHTML = `
                <div class="text-center">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${pokemon.id}.png" 
                         alt="${pokemon.name}" 
                         class="w-24 h-24 mx-auto mb-2"
                         loading="lazy">
                    <h3 class="font-bold text-lg capitalize mb-1">${pokemon.name}</h3>
                    <p class="text-gray-600 text-sm">#${paddedId}</p>
                </div>
            `;

            return card;
        }

        // Crear elemento de lista de Pokémon
        function createPokemonListItem(pokemon) {
            const item = document.createElement('div');
            item.className = 'bg-white rounded-lg shadow p-4 flex items-center gap-4 cursor-pointer hover:shadow-md';
            item.onclick = () => showPokemonDetails(pokemon.id);

            const paddedId = String(pokemon.id).padStart(3, '0');
            
            item.innerHTML = `
                <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${pokemon.id}.png" 
                     alt="${pokemon.name}" 
                     class="w-16 h-16"
                     loading="lazy">
                <div class="flex-1">
                    <h3 class="font-bold text-lg capitalize">${pokemon.name}</h3>
                    <p class="text-gray-600">#${paddedId}</p>
                </div>
                <i class="fas fa-chevron-right text-gray-400"></i>
            `;

            return item;
        }

        // Mostrar detalles del Pokémon
        async function showPokemonDetails(pokemonId) {
            const modal = document.getElementById('pokemonModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');

            modal.classList.add('active');
            modalContent.innerHTML = '<div class="text-center py-8"><div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-red-500"></div></div>';

            try {
                const [pokemonData, speciesData] = await Promise.all([
                    fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonId}`).then(r => r.json()),
                    fetch(`https://pokeapi.co/api/v2/pokemon-species/${pokemonId}`).then(r => r.json())
                ]);

                const paddedId = String(pokemonId).padStart(3, '0');
                modalTitle.textContent = `${pokemonData.name} #${paddedId}`;

                // Cargar detalles de movimientos
                const moveDetails = await loadMoveDetails(pokemonData.moves.slice(0, 10));

                // Cargar ubicaciones reales
                const locations = await loadPokemonLocations(pokemonId);

                modalContent.innerHTML = `
                    <div class="grid md:grid-cols-3 gap-6">
                        <!-- Información básica -->
                        <div class="space-y-4">
                            <div class="text-center">
                                <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${pokemonId}.png" 
                                     alt="${pokemonData.name}" 
                                     class="w-48 h-48 mx-auto">
                            </div>
                            <div class="text-center">
                                <h3 class="text-xl font-bold capitalize mb-2">${pokemonData.name}</h3>
                                <div class="flex justify-center gap-2 mb-2">
                                    ${pokemonData.types.map(type => 
                                        `<span class="type-badge" style="background-color: ${typeColors[type.type.name]}">${type.type.name}</span>`
                                    ).join('')}
                                </div>
                                <p class="text-gray-600">${getPokemonDescription(speciesData)}</p>
                            </div>
                        </div>

                        <!-- Estadísticas -->
                        <div>
                            <h3 class="text-lg font-bold mb-3">Estadísticas Base</h3>
                            <div class="space-y-2">
                                ${pokemonData.stats.map(stat => `
                                    <div class="flex items-center gap-3">
                                        <span class="w-24 text-sm font-medium">${getStatName(stat.stat.name)}</span>
                                        <span class="w-12 text-sm font-bold">${stat.base_stat}</span>
                                        <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden">
                                            <div class="stat-bar h-full bg-gradient-to-r from-red-400 to-red-600 rounded-full" 
                                                 style="width: ${Math.min(stat.base_stat / 255 * 100, 100)}%"></div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="mt-4 p-3 bg-gray-100 rounded-lg">
                                <p class="text-sm"><strong>Total:</strong> ${pokemonData.stats.reduce((sum, stat) => sum + stat.base_stat, 0)}</p>
                            </div>
                        </div>

                        <!-- Ubicaciones -->
                        <div>
                            <h3 class="text-lg font-bold mb-3">Ubicaciones</h3>
                            <div class="space-y-2 max-h-64 overflow-y-auto">
                                ${locations.length > 0 ? locations.map(location => `
                                    <div class="location-item p-2 bg-gray-50 rounded cursor-pointer">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <p class="font-medium">${location.game}</p>
                                                <p class="text-sm text-gray-600">${location.location}</p>
                                            </div>
                                            <span class="location-method ${location.methodClass}">${location.method}</span>
                                        </div>
                                    </div>
                                `).join('') : '<p class="text-gray-500">Este Pokémon no aparece en ubicaciones salvajes conocidas.</p>'}
                            </div>
                        </div>
                    </div>

                    <!-- Evoluciones -->
                    <div class="mt-6">
                        <h3 class="text-lg font-bold mb-3">Cadena Evolutiva</h3>
                        <div id="evolutionChain" class="flex items-center justify-center gap-4 flex-wrap">
                            <div class="text-center">
                                <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-red-500"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Movimientos Detallados -->
                    <div class="mt-6">
                        <h3 class="text-lg font-bold mb-3">Movimientos Detallados</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Movimiento</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tipo</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Categoría</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Poder</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Precisión</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">PP</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Método</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${moveDetails.map(move => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-4 py-2 text-sm font-medium capitalize">${move.name.replace('-', ' ')}</td>
                                            <td class="px-4 py-2">
                                                <span class="type-badge" style="background-color: ${typeColors[move.type]}">${move.type}</span>
                                            </td>
                                            <td class="px-4 py-2">
                                                ${move.damage_class === 'physical' ? '<i class="fas fa-fist-raised text-red-500"></i>' :
                                                  move.damage_class === 'special' ? '<i class="fas fa-brain text-blue-500"></i>' :
                                                  '<i class="fas fa-shield-alt text-green-500"></i>'}
                                            </td>
                                            <td class="px-4 py-2 text-sm">${move.power || '-'}</td>
                                            <td class="px-4 py-2 text-sm">${move.accuracy || '-'}</td>
                                            <td class="px-4 py-2 text-sm">${move.pp}</td>
                                            <td class="px-4 py-2">
                                                ${move.method === 'level-up' ? `<span class="move-method move-level">Nivel ${move.level}</span>` :
                                                  move.method === 'machine' ? '<span class="move-method move-tm">MT/MO</span>' :
                                                  move.method === 'tutor' ? '<span class="move-method move-tutor">Tutor</span>' :
                                                  move.method === 'egg' ? '<span class="move-method move-egg">Huevo</span>' :
                                                  '<span class="text-xs text-gray-500">Desconocido</span>'}
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;

                // Cargar cadena evolutiva
                loadEvolutionChain(speciesData.evolution_chain.url);

            } catch (error) {
                console.error('Error al cargar detalles del Pokémon:', error);
                modalContent.innerHTML = '<p class="text-center text-red-500">Error al cargar los detalles del Pokémon.</p>';
            }
        }

        // Cargar ubicaciones de Pokémon
        async function loadPokemonLocations(pokemonId) {
            try {
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonId}/encounters`);
                const encounters = await response.json();
                
                const locations = [];
                
                encounters.forEach(encounter => {
                    encounter.version_details.forEach(version => {
                        locations.push({
                            game: getVersionName(version.version.name),
                            location: getLocationName(encounter.location_area.name),
                            method: getEncounterMethod(encounter),
                            methodClass: getEncounterMethodClass(encounter)
                        });
                    });
                });

                // Eliminar duplicados y ordenar
                const uniqueLocations = locations.filter((loc, index, self) =>
                    index === self.findIndex(l => l.game === loc.game && l.location === loc.location)
                );

                return uniqueLocations.slice(0, 10); // Limitar a 10 ubicaciones
            } catch (error) {
                console.error('Error al cargar ubicaciones:', error);
                return [];
            }
        }

        // Obtener nombre de versión
        function getVersionName(version) {
            const versionNames = {
                'red': 'Rojo', 'blue': 'Azul', 'yellow': 'Amarillo',
                'gold': 'Oro', 'silver': 'Plata', 'crystal': 'Cristal',
                'ruby': 'Rubí', 'sapphire': 'Zafiro', 'emerald': 'Esmeralda',
                'diamond': 'Diamante', 'pearl': 'Perla', 'platinum': 'Platino',
                'heartgold': 'HeartGold', 'soulsilver': 'SoulSilver',
                'black': 'Negro', 'white': 'Blanco', 'black-2': 'Negro 2', 'white-2': 'Blanco 2',
                'x': 'X', 'y': 'Y', 'omega-ruby': 'Rubí Omega', 'alpha-sapphire': 'Zafiro Alfa',
                'sun': 'Sol', 'moon': 'Luna', 'ultra-sun': 'UltraSol', 'ultra-moon': 'UltraLuna',
                'sword': 'Espada', 'shield': 'Escudo', 'brilliant-diamond': 'Diamante Brillante',
                'shining-pearl': 'Perla Reluciente', 'legends-arceus': 'Leyendas: Arceus',
                'scarlet': 'Escarlata', 'violet': 'Púrpura'
            };
            return versionNames[version] || version;
        }

        // Obtener nombre de ubicación
        function getLocationName(location) {
            return location.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        // Obtener método de encuentro
        function getEncounterMethod(encounter) {
            if (encounter.method === 'walk') return 'Salvaje';
            if (encounter.method === 'old-rod') return 'Caña Vieja';
            if (encounter.method === 'good-rod') return 'Caña Buena';
            if (encounter.method === 'super-rod') return 'Caña Súper';
            if (encounter.method === 'surf') return 'Surf';
            if (encounter.method === 'rock-smash') return 'Golpe Roca';
            if (encounter.method === 'headbutt') return 'Golpe Cabeza';
            if (encounter.method === 'dark-grass') return 'Hierba Alta';
            if (encounter.method === 'grass') return 'Hierba';
            if (encounter.method === 'cave') return 'Cueva';
            if (encounter.method === 'safari-zone') return 'Safari';
            return encounter.method;
        }

        // Obtener clase CSS para método de encuentro
        function getEncounterMethodClass(encounter) {
            if (['walk', 'grass', 'dark-grass', 'cave'].includes(encounter.method)) return 'wild';
            if (['old-rod', 'good-rod', 'super-rod', 'surf', 'rock-smash'].includes(encounter.method)) return 'wild';
            return 'wild';
        }

        // Cargar detalles de movimientos
        async function loadMoveDetails(moves) {
            const moveDetails = await Promise.all(
                moves.map(async move => {
                    try {
                        const moveData = await fetch(move.move.url).then(r => r.json());
                        const versionDetail = move.version_group_details[0];
                        return {
                            name: moveData.name,
                            type: moveData.type.name,
                            damage_class: moveData.damage_class.name,
                            power: moveData.power,
                            accuracy: moveData.accuracy,
                            pp: moveData.pp,
                            method: versionDetail.move_learn_method.name,
                            level: versionDetail.level_learned_at
                        };
                    } catch (error) {
                        return null;
                    }
                })
            );

            return moveDetails.filter(move => move !== null);
        }

        // Generar tabla de tipos
        function generateTypeTable() {
            const tbody = document.getElementById('typeTableBody');
            const types = Object.keys(typeColors);
            
            tbody.innerHTML = types.map(attackingType => `
                <tr>
                    <th><span class="type-badge" style="background-color: ${typeColors[attackingType]}">${getTypeNameSpanish(attackingType)}</span></th>
                    ${types.map(defendingType => {
                        const effectiveness = typeEffectiveness[attackingType][defendingType] || 1;
                        let className = 'effectiveness-1';
                        if (effectiveness === 0) className = 'effectiveness-0';
                        else if (effectiveness === 0.25) className = 'effectiveness-025';
                        else if (effectiveness === 0.5) className = 'effectiveness-05';
                        else if (effectiveness === 2) className = 'effectiveness-2';
                        else if (effectiveness === 4) className = 'effectiveness-4';
                        
                        return `<td class="${className}">${effectiveness}x</td>`;
                    }).join('')}
                </tr>
            `).join('');
        }

        // Obtener nombre de tipo en español
        function getTypeNameSpanish(type) {
            const typeNames = {
                normal: 'Normal', fire: 'Fuego', water: 'Agua', electric: 'Eléctrico',
                grass: 'Planta', ice: 'Hielo', fighting: 'Lucha', poison: 'Veneno',
                ground: 'Tierra', flying: 'Volador', psychic: 'Psíquico', bug: 'Bicho',
                rock: 'Roca', ghost: 'Fantasma', dragon: 'Dragón', dark: 'Siniestro',
                steel: 'Acero', fairy: 'Hada'
            };
            return typeNames[type] || type;
        }

        // Cargar cadena evolutiva
        async function loadEvolutionChain(url) {
            try {
                const response = await fetch(url);
                const data = await response.json();
                const evolutionChain = parseEvolutionChain(data.chain);
                
                const chainContainer = document.getElementById('evolutionChain');
                chainContainer.innerHTML = evolutionChain.map((pokemon, index) => `
                    <div class="text-center ${index > 0 ? 'evolution-arrow' : ''}">
                        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${pokemon.id}.png" 
                             alt="${pokemon.name}" 
                             class="w-20 h-20 mx-auto mb-1">
                        <p class="text-sm font-medium capitalize">${pokemon.name}</p>
                        ${pokemon.condition ? `<p class="text-xs text-gray-600">${pokemon.condition}</p>` : ''}
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error al cargar cadena evolutiva:', error);
                document.getElementById('evolutionChain').innerHTML = '<p class="text-gray-500">No tiene evoluciones</p>';
            }
        }

        // Parsear cadena evolutiva
        function parseEvolutionChain(chain) {
            const evolutions = [];
            
            function parseChain(chainNode, condition = null) {
                const pokemonId = parseInt(chainNode.species.url.split('/').slice(-2, -1)[0]);
                evolutions.push({
                    id: pokemonId,
                    name: chainNode.species.name,
                    condition: condition
                });
                
                if (chainNode.evolves_to.length > 0) {
                    chainNode.evolves_to.forEach(evolution => {
                        let conditionText = '';
                        if (evolution.evolution_details[0]) {
                            const details = evolution.evolution_details[0];
                            if (details.min_level) conditionText = `Nivel ${details.min_level}`;
                            else if (details.item) conditionText = `Usar ${details.item.name.replace('-', ' ')}`;
                            else if (details.trigger.name === 'trade') conditionText = 'Intercambiar';
                            else if (details.min_happiness) conditionText = `Amistad ${details.min_happiness}`;
                            else if (details.time_of_day) conditionText = `Hora: ${details.time_of_day}`;
                            else if (details.known_move) conditionText = `Conocer ${details.known_move.name}`;
                            else if (details.known_move_type) conditionText = `Conocer movimiento tipo ${details.known_move_type.name}`;
                            else if (details.location) conditionText = `En ${details.location.name}`;
                        }
                        parseChain(evolution, conditionText);
                    });
                }
            }
            
            parseChain(chain);
            return evolutions;
        }

        // Obtener descripción del Pokémon
        function getPokemonDescription(speciesData) {
            const flavorText = speciesData.flavor_text_entries.find(entry => 
                entry.language.name === 'es'
            );
            return flavorText ? flavorText.flavor_text.replace(/\f/g, ' ') : 'Descripción no disponible';
        }

        // Obtener nombre de estadística en español
        function getStatName(statName) {
            const statNames = {
                'hp': 'PS',
                'attack': 'Ataque',
                'defense': 'Defensa',
                'special-attack': 'Atq. Esp.',
                'special-defense': 'Def. Esp.',
                'speed': 'Velocidad'
            };
            return statNames[statName] || statName;
        }

        // Manejar búsqueda
        function handleSearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            filteredPokemon = allPokemon.filter(pokemon => 
                pokemon.name.toLowerCase().includes(searchTerm) || 
                pokemon.id.toString().includes(searchTerm)
            );
            currentPage = 1;
            renderPokemon();
            renderPagination();
        }

        // Manejar cambio de modo de vista
        function handleViewModeChange(e) {
            viewMode = e.target.value;
            renderPokemon();
        }

        // Manejar cambio de items por página
        function handleItemsPerPageChange(e) {
            itemsPerPage = parseInt(e.target.value);
            currentPage = 1;
            renderPokemon();
            renderPagination();
        }

        // Renderizar paginación
        function renderPagination() {
            const pagination = document.getElementById('pagination');
            const totalPages = Math.ceil(filteredPokemon.length / itemsPerPage);
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let paginationHTML = '';
            
            // Botón anterior
            paginationHTML += `
                <button onclick="changePage(${currentPage - 1})" 
                        class="px-3 py-1 rounded-lg ${currentPage === 1 ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-white text-gray-700 hover:bg-gray-100'}"
                        ${currentPage === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;

            // Números de página
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);

            if (startPage > 1) {
                paginationHTML += `<button onclick="changePage(1)" class="px-3 py-1 rounded-lg bg-white text-gray-700 hover:bg-gray-100">1</button>`;
                if (startPage > 2) {
                    paginationHTML += `<span class="px-2">...</span>`;
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <button onclick="changePage(${i})" 
                            class="px-3 py-1 rounded-lg ${i === currentPage ? 'bg-red-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}">
                        ${i}
                    </button>
                `;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += `<span class="px-2">...</span>`;
                }
                paginationHTML += `<button onclick="changePage(${totalPages})" class="px-3 py-1 rounded-lg bg-white text-gray-700 hover:bg-gray-100">${totalPages}</button>`;
            }

            // Botón siguiente
            paginationHTML += `
                <button onclick="changePage(${currentPage + 1})" 
                        class="px-3 py-1 rounded-lg ${currentPage === totalPages ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-white text-gray-700 hover:bg-gray-100'}"
                        ${currentPage === totalPages ? 'disabled' : ''}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;

            pagination.innerHTML = paginationHTML;
        }

        // Cambiar página
        function changePage(page) {
            const totalPages = Math.ceil(filteredPokemon.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderPokemon();
                renderPagination();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Cerrar modal
        function closeModal() {
            document.getElementById('pokemonModal').classList.remove('active');
        }

        // Mostrar indicador de carga
        function showLoading() {
            document.getElementById('loadingIndicator').classList.remove('hidden');
        }

        // Ocultar indicador de carga
        function hideLoading() {
            document.getElementById('loadingIndicator').classList.add('hidden');
        }

        // Mostrar error
        function showError(message) {
            const container = document.getElementById('pokemonContainer');
            container.innerHTML = `
                <div class="col-span-full text-center py-8">
                    <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                    <p class="text-gray-600">${message}</p>
                </div>
            `;
        }

        // Cerrar modal al hacer clic fuera
        document.getElementById('pokemonModal').addEventListener('click', (e) => {
            if (e.target.id === 'pokemonModal') {
                closeModal();
            }
        });
    </script>
</body>
</html>
